#  Attendance Queries

## Quick Navigation

- [overview](1-overview.md)
- [system-architecture](2-system-architecture.md)
  - [application-configuration](2.1-application-configuration.md)
- [database-models](3-database-models.md)
  - [member-model](3.1-member-model.md)
  - [attendance-model](3.2-attendance-model.md)
  - [streak-model](3.3-streak-model.md)
  - [project-model](3.4-project-model.md)
- [graphql-api](4-graphql-api.md)
  - [graphql-queries](4.1-graphql-queries.md)
    - [member-queries](4.1.1-member-queries.md)
    - [attendance-queries](4.1.2-attendance-queries.md)
    - [streak-queries](4.1.3-streak-queries.md)
    - [project-queries](4.1.4-project-queries.md)
  - [graphql-mutations](4.2-graphql-mutations.md)
    - [member-mutations](4.2.1-member-mutations.md)
    - [attendance-mutations](4.2.2-attendance-mutations.md)
    - [streak-mutations](4.2.3-streak-mutations.md)
    - [project-mutations](4.2.4-project-mutations.md)
- [background-tasks](5-background-tasks.md)
  - [daily-attendance-task](5.1-daily-attendance-task.md)
- [deployment-and-cicd](6-deployment-and-cicd.md)
  - [github-actions-workflows](6.1-github-actions-workflows.md)
  - [docker-deployment](6.2-docker-deployment.md)
- [security-features](7-security-features.md)
  - [hmac-authentication](7.1-hmac-authentication.md)

## Table of Contents

- [Attendance Queries](#attendance-queries)
  - [Purpose and Scope](#purpose-and-scope)
  - [Available Attendance Queries](#available-attendance-queries)
    - [Query Implementation Details](#query-implementation-details)
      - [Attendance Query](#attendance-query)
      - [Attendance By Date Query](#attendance-by-date-query)
  - [Data Flow Diagram](#data-flow-diagram)
  - [Return Data Models](#return-data-models)
    - [Attendance Model](#attendance-model)
    - [AttendanceWithMember Model](#attendancewithmember-model)
  - [Query Processing Flow](#query-processing-flow)
  - [Example Usage](#example-usage)
    - [Query Attendance for a Member](#query-attendance-for-a-member)
    - [Query Attendance for a Specific Date](#query-attendance-for-a-specific-date)
  - [Implementation Details](#implementation-details)
    - [Database Access Pattern](#database-access-pattern)
  - [Related Components](#related-components)

# Attendance Queries

Relevant source files

* [src/graphql/queries/attendance\_queries.rs](https://github.com/amfoss/root/blob/2b58803d/src/graphql/queries/attendance_queries.rs)

## Purpose and Scope

This document details the GraphQL attendance queries available in the Root system. These queries allow client applications to retrieve attendance data for club members, either filtered by member ID or by specific dates. For information about modifying attendance records, see [Attendance Mutations](/amfoss/root/4.2.2-attendance-mutations).

Sources: [src/graphql/queries/attendance\_queries.rs8-12](https://github.com/amfoss/root/blob/2b58803d/src/graphql/queries/attendance_queries.rs#L8-L12)

## Available Attendance Queries

Root provides two primary attendance queries implemented in the `AttendanceQueries` struct:

| Query | Description | Parameters | Return Type |
| --- | --- | --- | --- |
| `attendance` | Retrieves all attendance records for a specific member | `member_id: i32` | `Vec<Attendance>` |
| `attendance_by_date` | Retrieves all attendance records for a specific date with member details | `date: NaiveDate` | `Vec<AttendanceWithMember>` |

Sources: [src/graphql/queries/attendance\_queries.rs11-44](https://github.com/amfoss/root/blob/2b58803d/src/graphql/queries/attendance_queries.rs#L11-L44)

### Query Implementation Details

#### Attendance Query

The `attendance` query retrieves all attendance records for a specific member identified by their member ID. It executes a direct SQL query to the Attendance table filtered by the member ID.

Implementation:
[src/graphql/queries/attendance\_queries.rs13-22](https://github.com/amfoss/root/blob/2b58803d/src/graphql/queries/attendance_queries.rs#L13-L22)

#### Attendance By Date Query

The `attendance_by_date` query retrieves attendance records for a specific date, joining with the Member table to include member details like name and year. This provides a comprehensive view of attendance on a particular day.

Implementation:
[src/graphql/queries/attendance\_queries.rs24-43](https://github.com/amfoss/root/blob/2b58803d/src/graphql/queries/attendance_queries.rs#L24-L43)

Sources: [src/graphql/queries/attendance\_queries.rs13-44](https://github.com/amfoss/root/blob/2b58803d/src/graphql/queries/attendance_queries.rs#L13-L44)

## Data Flow Diagram

The following diagram illustrates how attendance queries process requests and interact with the database:

Sources: [src/graphql/queries/attendance\_queries.rs13-44](https://github.com/amfoss/root/blob/2b58803d/src/graphql/queries/attendance_queries.rs#L13-L44)

## Return Data Models

### Attendance Model

The `Attendance` model represents a single attendance record for a member on a specific date.

### AttendanceWithMember Model

The `AttendanceWithMember` model extends the attendance data with relevant member information through a SQL join operation.

Sources: [src/graphql/queries/attendance\_queries.rs3](https://github.com/amfoss/root/blob/2b58803d/src/graphql/queries/attendance_queries.rs#L3-L3)

## Query Processing Flow

This diagram illustrates how the attendance queries are processed within the system:

Sources: [src/graphql/queries/attendance\_queries.rs13-44](https://github.com/amfoss/root/blob/2b58803d/src/graphql/queries/attendance_queries.rs#L13-L44)

## Example Usage

### Query Attendance for a Member

### Query Attendance for a Specific Date

## Implementation Details

### Database Access Pattern

Both attendance queries follow a similar pattern for database access:

1. Extract the database connection pool from the GraphQL context
2. Construct a SQL query using `sqlx::query_as` to map results directly to their respective structs
3. Execute the query against the PostgreSQL database
4. Return the results wrapped in a GraphQL `Result` type

This pattern ensures type safety through Rust's strong typing system, with database query results mapped directly to strongly-typed structs.

Sources: [src/graphql/queries/attendance\_queries.rs14-21](https://github.com/amfoss/root/blob/2b58803d/src/graphql/queries/attendance_queries.rs#L14-L21) [src/graphql/queries/attendance\_queries.rs29-42](https://github.com/amfoss/root/blob/2b58803d/src/graphql/queries/attendance_queries.rs#L29-L42)

## Related Components

The attendance queries are closely related to:

* The **Attendance Model** (see [Database Models - Attendance Model](/amfoss/root/3.2-attendance-model)) which defines the data structure
* The **Member Model** (see [Database Models - Member Model](/amfoss/root/3.1-member-model)) used in the join operation for the attendance\_by\_date query
* The **Attendance Mutations** (see [GraphQL Mutations - Attendance Mutations](/amfoss/root/4.2.2-attendance-mutations)) for modifying attendance records
* The **Daily Attendance Task** (see [Background Tasks - Daily Attendance Task](/amfoss/root/5.1-daily-attendance-task)) which inserts default attendance records daily