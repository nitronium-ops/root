#  Graphql Queries

## Quick Navigation

- [overview](1-overview.md)
- [system-architecture](2-system-architecture.md)
  - [application-configuration](2.1-application-configuration.md)
- [database-models](3-database-models.md)
  - [member-model](3.1-member-model.md)
  - [attendance-model](3.2-attendance-model.md)
  - [streak-model](3.3-streak-model.md)
  - [project-model](3.4-project-model.md)
- [graphql-api](4-graphql-api.md)
  - [graphql-queries](4.1-graphql-queries.md)
    - [member-queries](4.1.1-member-queries.md)
    - [attendance-queries](4.1.2-attendance-queries.md)
    - [streak-queries](4.1.3-streak-queries.md)
    - [project-queries](4.1.4-project-queries.md)
  - [graphql-mutations](4.2-graphql-mutations.md)
    - [member-mutations](4.2.1-member-mutations.md)
    - [attendance-mutations](4.2.2-attendance-mutations.md)
    - [streak-mutations](4.2.3-streak-mutations.md)
    - [project-mutations](4.2.4-project-mutations.md)
- [background-tasks](5-background-tasks.md)
  - [daily-attendance-task](5.1-daily-attendance-task.md)
- [deployment-and-cicd](6-deployment-and-cicd.md)
  - [github-actions-workflows](6.1-github-actions-workflows.md)
  - [docker-deployment](6.2-docker-deployment.md)
- [security-features](7-security-features.md)
  - [hmac-authentication](7.1-hmac-authentication.md)

## Table of Contents

- [GraphQL Queries](#graphql-queries)
  - [Query Architecture Overview](#query-architecture-overview)
  - [Available Queries](#available-queries)
  - [Query Data Relationships](#query-data-relationships)
  - [Complex Object Fields](#complex-object-fields)
    - [Member Complex Field Implementation](#member-complex-field-implementation)
  - [Query Implementation Details](#query-implementation-details)
    - [Member Queries](#member-queries)
    - [Attendance Queries](#attendance-queries)
    - [Streak Queries](#streak-queries)
    - [Project Queries](#project-queries)
  - [Query Execution Flow](#query-execution-flow)
  - [Connection Pool Usage](#connection-pool-usage)

# GraphQL Queries

Relevant source files

* [src/graphql/mutations/project\_mutations.rs](https://github.com/amfoss/root/blob/2b58803d/src/graphql/mutations/project_mutations.rs)
* [src/graphql/queries/attendance\_queries.rs](https://github.com/amfoss/root/blob/2b58803d/src/graphql/queries/attendance_queries.rs)
* [src/graphql/queries/member\_queries.rs](https://github.com/amfoss/root/blob/2b58803d/src/graphql/queries/member_queries.rs)
* [src/graphql/queries/project\_queries.rs](https://github.com/amfoss/root/blob/2b58803d/src/graphql/queries/project_queries.rs)
* [src/graphql/queries/streak\_queries.rs](https://github.com/amfoss/root/blob/2b58803d/src/graphql/queries/streak_queries.rs)

This page documents the GraphQL query capabilities available in the Root system. GraphQL queries provide read-only access to the data stored in the PostgreSQL database, allowing clients to retrieve specific information about members, attendance records, status update streaks, and projects.

For information about modifying data, see [GraphQL Mutations](/amfoss/root/4.2-graphql-mutations).

## Query Architecture Overview

GraphQL queries in Root are organized by domain into four main categories, each implemented as a separate query resolver class in the codebase:

Sources: [src/graphql/queries/member\_queries.rs12-16](https://github.com/amfoss/root/blob/2b58803d/src/graphql/queries/member_queries.rs#L12-L16) [src/graphql/queries/attendance\_queries.rs8-11](https://github.com/amfoss/root/blob/2b58803d/src/graphql/queries/attendance_queries.rs#L8-L11) [src/graphql/queries/streak\_queries.rs7-10](https://github.com/amfoss/root/blob/2b58803d/src/graphql/queries/streak_queries.rs#L7-L10) [src/graphql/queries/project\_queries.rs7-10](https://github.com/amfoss/root/blob/2b58803d/src/graphql/queries/project_queries.rs#L7-L10)

## Available Queries

The following queries are available in the Root GraphQL API:

| Domain | Query | Description | Parameters | Return Type |
| --- | --- | --- | --- | --- |
| Member | `members` | Retrieves a list of members, optionally filtered by year and group ID | `year` (optional), `group_id` (optional) | `[Member]` |
| Attendance | `attendance` | Retrieves attendance records for a specific member | `member_id` (required) | `[Attendance]` |
| Attendance | `attendanceByDate` | Retrieves attendance records for all members on a specific date | `date` (required) | `[AttendanceWithMember]` |
| Streak | `streak` | Retrieves streak information for a specific member | `member_id` (required) | `StatusUpdateStreak` |
| Streak | `streaks` | Retrieves streak information for all members | None | `[StatusUpdateStreak]` |
| Project | `projects` | Retrieves all projects | None | `[Project]` |

Sources: [src/graphql/queries/member\_queries.rs17-43](https://github.com/amfoss/root/blob/2b58803d/src/graphql/queries/member_queries.rs#L17-L43) [src/graphql/queries/attendance\_queries.rs12-43](https://github.com/amfoss/root/blob/2b58803d/src/graphql/queries/attendance_queries.rs#L12-L43) [src/graphql/queries/streak\_queries.rs11-31](https://github.com/amfoss/root/blob/2b58803d/src/graphql/queries/streak_queries.rs#L11-L31) [src/graphql/queries/project\_queries.rs11-21](https://github.com/amfoss/root/blob/2b58803d/src/graphql/queries/project_queries.rs#L11-L21)

## Query Data Relationships

The following diagram illustrates the relationships between the different data types that can be queried:

Sources: [src/graphql/queries/member\_queries.rs17-43](https://github.com/amfoss/root/blob/2b58803d/src/graphql/queries/member_queries.rs#L17-L43) [src/graphql/queries/attendance\_queries.rs12-43](https://github.com/amfoss/root/blob/2b58803d/src/graphql/queries/attendance_queries.rs#L12-L43) [src/graphql/queries/streak\_queries.rs11-31](https://github.com/amfoss/root/blob/2b58803d/src/graphql/queries/streak_queries.rs#L11-L31) [src/graphql/queries/project\_queries.rs11-21](https://github.com/amfoss/root/blob/2b58803d/src/graphql/queries/project_queries.rs#L11-L21)

## Complex Object Fields

In addition to the top-level queries, the `Member` type supports complex object fields that allow for nested data retrieval:

Sources: [src/graphql/queries/member\_queries.rs46-94](https://github.com/amfoss/root/blob/2b58803d/src/graphql/queries/member_queries.rs#L46-L94)

### Member Complex Field Implementation

The `Member` type is extended with complex object fields in the GraphQL schema through the `ComplexObject` trait implementation. These fields provide related data for a member:

* `attendance`: Returns attendance records for the member
* `attendanceSummary`: Returns monthly attendance summaries
* `streak`: Returns status update streak information
* `projects`: Returns projects associated with the member

Each of these fields executes a separate SQL query to fetch the related data when requested.

Sources: [src/graphql/queries/member\_queries.rs46-94](https://github.com/amfoss/root/blob/2b58803d/src/graphql/queries/member_queries.rs#L46-L94)

## Query Implementation Details

### Member Queries

The `MemberQueries` struct implements the `members` query, which dynamically constructs an SQL query based on the provided filters:

* If `year` is provided, it filters members by their academic year
* If `group_id` is provided, it filters members by their group

The query uses SQLx query builder to safely construct and execute the parameterized SQL query.

Sources: [src/graphql/queries/member\_queries.rs15-43](https://github.com/amfoss/root/blob/2b58803d/src/graphql/queries/member_queries.rs#L15-L43)

### Attendance Queries

The `AttendanceQueries` struct implements:

1. `attendance`: Fetches attendance records for a specific member using their member ID
2. `attendanceByDate`: Fetches attendance records for all members on a specific date, including basic member information like name and year

Both queries use SQLx for safe SQL query execution.

Sources: [src/graphql/queries/attendance\_queries.rs11-44](https://github.com/amfoss/root/blob/2b58803d/src/graphql/queries/attendance_queries.rs#L11-L44)

### Streak Queries

The `StreakQueries` struct implements:

1. `streak`: Fetches the status update streak information for a single member
2. `streaks`: Fetches streak information for all members

Sources: [src/graphql/queries/streak\_queries.rs10-32](https://github.com/amfoss/root/blob/2b58803d/src/graphql/queries/streak_queries.rs#L10-L32)

### Project Queries

The `ProjectQueries` struct implements the `projects` query, which retrieves all projects stored in the database.

Sources: [src/graphql/queries/project\_queries.rs10-21](https://github.com/amfoss/root/blob/2b58803d/src/graphql/queries/project_queries.rs#L10-L21)

## Query Execution Flow

The following sequence diagram illustrates how a GraphQL query is processed:

Sources: [src/graphql/queries/member\_queries.rs17-43](https://github.com/amfoss/root/blob/2b58803d/src/graphql/queries/member_queries.rs#L17-L43) [src/graphql/queries/attendance\_queries.rs12-43](https://github.com/amfoss/root/blob/2b58803d/src/graphql/queries/attendance_queries.rs#L12-L43) [src/graphql/queries/streak\_queries.rs11-31](https://github.com/amfoss/root/blob/2b58803d/src/graphql/queries/streak_queries.rs#L11-L31) [src/graphql/queries/project\_queries.rs11-21](https://github.com/amfoss/root/blob/2b58803d/src/graphql/queries/project_queries.rs#L11-L21)

## Connection Pool Usage

All query resolvers in the Root system follow a common pattern for accessing the database:

1. Extract the PostgreSQL connection pool from the GraphQL context
2. Construct a query using SQLx
3. Execute the query against the database
4. Return the results or an error

The connection pool is shared across all resolvers and managed by the application infrastructure.

Sources: [src/graphql/queries/member\_queries.rs23](https://github.com/amfoss/root/blob/2b58803d/src/graphql/queries/member_queries.rs#L23-L23) [src/graphql/queries/attendance\_queries.rs14](https://github.com/amfoss/root/blob/2b58803d/src/graphql/queries/attendance_queries.rs#L14-L14) [src/graphql/queries/streak\_queries.rs13](https://github.com/amfoss/root/blob/2b58803d/src/graphql/queries/streak_queries.rs#L13-L13) [src/graphql/queries/project\_queries.rs13](https://github.com/amfoss/root/blob/2b58803d/src/graphql/queries/project_queries.rs#L13-L13)

For more detailed information about specific query domains, see:

* [Member Queries](/amfoss/root/4.1.1-member-queries)
* [Attendance Queries](/amfoss/root/4.1.2-attendance-queries)
* [Streak Queries](/amfoss/root/4.1.3-streak-queries)
* [Project Queries](/amfoss/root/4.1.4-project-queries)