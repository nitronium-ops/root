# Streak Model

## Quick Navigation

- [Overview](1-overview.md)
- [System Architecture](2-system-architecture.md)
  - [Application Configuration](2.1-application-configuration.md)
- [Database Models](3-database-models.md)
  - [Member Model](3.1-member-model.md)
  - [Attendance Model](3.2-attendance-model.md)
  - [Streak Model](3.3-streak-model.md)
  - [Project Model](3.4-project-model.md)
- [GraphQL API](4-graphql-api.md)
  - [GraphQL Queries](4.1-graphql-queries.md)
    - [Member Queries](4.1.1-member-queries.md)
    - [Attendance Queries](4.1.2-attendance-queries.md)
    - [Streak Queries](4.1.3-streak-queries.md)
    - [Project Queries](4.1.4-project-queries.md)
  - [GraphQL Mutations](4.2-graphql-mutations.md)
    - [Member Mutations](4.2.1-member-mutations.md)
    - [Attendance Mutations](4.2.2-attendance-mutations.md)
    - [Streak Mutations](4.2.3-streak-mutations.md)
    - [Project Mutations](4.2.4-project-mutations.md)
- [Background Tasks](5-background-tasks.md)
  - [Daily Attendance Task](5.1-daily-attendance-task.md)
- [Deployment and CI/CD](6-deployment-and-cicd.md)
  - [GitHub Actions Workflows](6.1-github-actions-workflows.md)
  - [Docker Deployment](6.2-docker-deployment.md)
- [Security Features](7-security-features.md)
  - [HMAC Authentication](7.1-hmac-authentication.md)

## Table of Contents

- [Streak Model](#streak-model)
  - [Purpose and Scope](#purpose-and-scope)
  - [Data Structure](#data-structure)
  - [Streak Business Logic](#streak-business-logic)
  - [Database Operations](#database-operations)
    - [Incrementing a Streak](#incrementing-a-streak)
    - [Resetting a Streak](#resetting-a-streak)
  - [SQL Implementation Details](#sql-implementation-details)
    - [Increment Streak SQL Logic](#increment-streak-sql-logic)
    - [Reset Streak SQL Logic](#reset-streak-sql-logic)
  - [Integration with GraphQL API](#integration-with-graphql-api)
  - [Use Cases](#use-cases)

# Streak Model

Relevant source files

* [src/graphql/mutations/streak\_mutations.rs](https://github.com/amfoss/root/blob/2b58803d/src/graphql/mutations/streak_mutations.rs)
* [src/models/status\_update\_streak.rs](https://github.com/amfoss/root/blob/2b58803d/src/models/status_update_streak.rs)

## Purpose and Scope

The Streak Model in Root tracks members' activity consistency through the `StatusUpdateStreak` data model. This model records how consistently members provide status updates, maintaining both current streak counts and historical maximum streaks. This document details the data structure, interactions, and business logic of the streak system.

For information about other data models in the system, see [Database Models](/amfoss/root/3-database-models). For specific streak-related GraphQL operations, see [Streak Queries](/amfoss/root/4.1.3-streak-queries) and [Streak Mutations](/amfoss/root/4.2.3-streak-mutations).

## Data Structure

The StatusUpdateStreak model maintains a record of a member's consistency in providing status updates. Each member can have exactly one streak record.

The `StatusUpdateStreak` model contains the following fields:

| Field | Type | Description |
| --- | --- | --- |
| `member_id` | i32 | Primary key and foreign key reference to Member model |
| `current_streak` | i32 | The member's current consecutive status update count |
| `max_streak` | i32 | The highest streak count the member has ever achieved |

Sources: [src/models/status\_update\_streak.rs4-9](https://github.com/amfoss/root/blob/2b58803d/src/models/status_update_streak.rs#L4-L9)

Additionally, the system defines auxiliary data structures for GraphQL operations:

1. `StatusUpdateStreakInfo` - A projection of streak data without the member ID, used for providing streak information without exposing the member\_id
2. `StreakInput` - An input object for streak-related mutations that takes a member\_id

Sources: [src/models/status\_update\_streak.rs11-20](https://github.com/amfoss/root/blob/2b58803d/src/models/status_update_streak.rs#L11-L20)

## Streak Business Logic

The streak model implements the following business rules:

1. Each member has at most one streak record
2. Streaks can be incremented (for consistent activity) or reset (for missed activity)
3. The system tracks both current streak and the all-time maximum streak
4. Streaks can be zero or negative (for consecutive missed updates)
5. When a member achieves a new personal best, the max\_streak is updated

Sources: [src/graphql/mutations/streak\_mutations.rs14-54](https://github.com/amfoss/root/blob/2b58803d/src/graphql/mutations/streak_mutations.rs#L14-L54)

## Database Operations

The streak system performs two primary operations on the database:

### Incrementing a Streak

When a member provides a status update, their streak is incremented through the following process:

1. If no streak record exists for the member, create one with current\_streak = 1 and max\_streak = 1
2. If a record exists:
   * Increment current\_streak by 1 (if current\_streak is non-negative)
   * Update max\_streak if the new current\_streak exceeds the previous max\_streak

Sources: [src/graphql/mutations/streak\_mutations.rs14-34](https://github.com/amfoss/root/blob/2b58803d/src/graphql/mutations/streak_mutations.rs#L14-L34)

### Resetting a Streak

When a member misses a status update, their streak is reset through the following process:

1. If no streak record exists for the member, create one with current\_streak = 0 and max\_streak = 0
2. If a record exists:
   * If current\_streak > 0, set it to 0
   * If current\_streak â‰¤ 0, decrement it further (making it more negative)

Sources: [src/graphql/mutations/streak\_mutations.rs36-54](https://github.com/amfoss/root/blob/2b58803d/src/graphql/mutations/streak_mutations.rs#L36-L54)

## SQL Implementation Details

The streak system uses SQL UPSERT operations (INSERT ... ON CONFLICT) to handle both new and existing streak records in a single operation.

### Increment Streak SQL Logic

This SQL query:

1. Attempts to insert a new record with streak = 1
2. On conflict (when a record already exists for the member):
   * Increments current\_streak if it's non-negative, or sets it to 1 if negative
   * Updates max\_streak to the greater of the current max\_streak or the new current\_streak value

Sources: [src/graphql/mutations/streak\_mutations.rs17-28](https://github.com/amfoss/root/blob/2b58803d/src/graphql/mutations/streak_mutations.rs#L17-L28)

### Reset Streak SQL Logic

This SQL query:

1. Attempts to insert a new record with streak = 0
2. On conflict (when a record already exists for the member):
   * Sets current\_streak to 0 if it's positive
   * Decrements current\_streak if it's 0 or negative

Sources: [src/graphql/mutations/streak\_mutations.rs39-49](https://github.com/amfoss/root/blob/2b58803d/src/graphql/mutations/streak_mutations.rs#L39-L49)

## Integration with GraphQL API

The streak system is exposed through the GraphQL API with mutations defined in the `StreakMutations` struct. The system provides two main mutations:

1. `incrementStreak` - Called when a member provides a status update
2. `resetStreak` - Called when a member misses a status update

These mutations accept a `StreakInput` object containing the member\_id and return the updated `StatusUpdateStreak` record.

Sources: [src/graphql/mutations/streak\_mutations.rs8-55](https://github.com/amfoss/root/blob/2b58803d/src/graphql/mutations/streak_mutations.rs#L8-L55) [src/models/status\_update\_streak.rs17-20](https://github.com/amfoss/root/blob/2b58803d/src/models/status_update_streak.rs#L17-L20)

## Use Cases

The StatusUpdateStreak model serves several important functions in the system:

1. **Member Accountability**: Tracking streak encourages consistent participation in status updates
2. **Member Recognition**: Members with high streaks can be recognized for their consistent participation
3. **Club Activity Metrics**: Streak data provides insights into overall member engagement
4. **Historical Performance**: The max\_streak field preserves a record of a member's best performance

The streaks can be integrated with client applications to display progress, gamify participation, and motivate members to maintain consistent activity.